@use "@sass:color";

$neu-light: #fcfcfc;
$neu-dark: #3e3e3e;
$neu-shadow-light: #ffffff;
$neu-shadow-dark: #2a2a2a;
$neu-radius: 10px;

$neu-shadow-x: 5px;
$neu-shadow-y: 5px;
$neu-blur: 10px;
$light-source: top left;
$light: $neu-light;
$dark: $neu-dark;

@mixin neu($light-source: top left, $light: #ffffff, $dark: #000000) {
    $h1: if(index($light-source, left), $neu-shadow-light, $neu-shadow-dark);
    $h2: if(index($light-source, left), $neu-shadow-dark, $neu-shadow-light);
    $v1: if(index($light-source, top), $neu-shadow-light, $neu-shadow-dark);
    $v2: if(index($light-source, top), $neu-shadow-dark, $neu-shadow-light);

    // Adjust shadows for contrast
    $shadow-light: if(lightness($light) > lightness($dark), $neu-shadow-dark, $neu-shadow-light);
    $shadow-dark: if(lightness($light) > lightness($dark), $neu-shadow-light, $neu-shadow-dark);

    // Calculate contrast ratio
    $contrast-ratio: contrast($dark, $light);

    // Ensure sufficient contrast
    @if $contrast-ratio < 4.5 {
        $light: #ffffff; // Fallback to white if contrast is too low
    }
    
    // Apply shadows
    box-shadow:
        $shadow-light + $neu-shadow-x + $neu-shadow-y + $neu-blur $dark,
        $shadow-dark + $neu-shadow-x + $neu-shadow-y + $neu-blur $light;
    border-radius: $neu-radius;
}

:host(.fx-neu) {
    --fx-neu-shadow-light: #fff;
    --fx-neu-shadow-dark: #000;
    --fx-neu-shadow-x: 10px;
    --fx-neu-shadow-y: 10px;
    --fx-neu-blur: 30px;
    --fx-neu-radius: 15px;
    display: inline-block;
    border-radius: var(--fx-neu-radius);
    overflow: hidden;
    will-change: box-shadow;
    transition: box-shadow 0.3s ease, border-radius 0.3s ease;
    @include neu(top left, var(--fx-neu-shadow-light), var(--fx-neu-shadow-dark));
}

:host(.fx-neu-top) {
    @include neu(top left, var(--fx-neu-shadow-light), var(--fx-neu-shadow-dark));
}

:host(.fx-neu-right) {
    @include neu(top right, var(--fx-neu-shadow-light), var(--fx-neu-shadow-dark));
}

:host(.fx-neu-bottom) {
    @include neu(bottom right, var(--fx-neu-shadow-light), var(--fx-neu-shadow-dark));
}

:host(.fx-neu-left) {
    @include neu(bottom left, var(--fx-neu-shadow-light), var(--fx-neu-shadow-dark));
}

